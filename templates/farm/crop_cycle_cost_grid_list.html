{% load static %}
{% if cost_set %}
    <div class="plot-grid-card">
        <div class="plot-grid-header">
            <span class="plot-grid-header-title">
                <i class="fas fa-list"></i>
                {% if cost_type == 'agrochemicals' %}
                    <i class="fas fa-flask"></i>
                    Registro de Agroquímicos
                {% elif cost_type == 'services' %}
                    <i class="fas fa-cog"></i>
                    Registro de Servicios
                {% else %}
                    Registro de Costos
                {% endif %}
            </span>
        </div>
        <div class="plot-grid-table-wrap">
            <table id="table-crop-cycle-cost-list" class="plot-grid-table">
                <thead>
                    <tr>
                        <th class="plot-grid-th plot-grid-th-num"><i class="fas fa-hashtag"></i></th>
                        <th class="plot-grid-th plot-grid-th-center"><i class="fas fa-calendar"></i> Fecha</th>
                        <th class="plot-grid-th plot-grid-th-center"><i class="fas fa-tags"></i> Área</th>
                        <th class="plot-grid-th"><i class="fas fa-box"></i> Concepto</th>
                        <th class="plot-grid-th plot-grid-th-center"><i class="fas fa-weight"></i> Cantidad</th>
                        <th class="plot-grid-th plot-grid-th-center"><i class="fas fa-dollar-sign"></i> Costo</th>
                        <th class="plot-grid-th plot-grid-th-center"><i class="fas fa-money-bill-wave"></i> Monto</th>
                        <th class="plot-grid-th plot-grid-th-actions">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cost in cost_set %}
                        <tr class="plot-grid-row" pk="{{ cost.id }}">
                            <td class="plot-grid-td plot-grid-td-num">
                                <span class="plot-grid-badge-num">{{ forloop.counter }}</span>
                            </td>
                            <td class="plot-grid-td plot-grid-td-center">
                                <span class="plot-grid-text">{{ cost.application_date|date:"d/m/Y" }}</span>
                            </td>
                            <td class="plot-grid-td plot-grid-td-center">
                                {% if cost.product.product_type == 'PRODUCT' %}
                                    {% if cost.product.product_category == 'AGROQUÍMICO' %}
                                        <span class="plot-grid-badge-soft" style="background: #fff3cd; color: #856404;">AGROQUÍMICO</span>
                                    {% elif cost.product.product_category == 'FERTILIZANTE' %}
                                        <span class="plot-grid-badge-soft" style="background: #d1ecf1; color: #0c5460;">FERTILIZANTE</span>
                                    {% else %}
                                        <span class="plot-grid-badge-soft">{{ cost.product.get_product_category_display|default:"N/A" }}</span>
                                    {% endif %}
                                {% elif cost.product.product_type == 'SERVICE' %}
                                    {% if cost.product.service_type %}
                                        <span class="plot-grid-badge-soft" style="background: #e2e3e5; color: #383d41;">{{ cost.product.service_type.name }}</span>
                                    {% else %}
                                        <span class="plot-grid-badge-soft">SERVICIO</span>
                                    {% endif %}
                                {% else %}
                                    <span class="plot-grid-muted">—</span>
                                {% endif %}
                            </td>
                            <td class="plot-grid-td">
                                <span class="plot-grid-name">
                                    {% if cost.product.product_type == 'PRODUCT' %}
                                        {{ cost.product.name }}
                                    {% elif cost.product.product_type == 'SERVICE' %}
                                        {{ cost.application_method|default:"Sin método especificado" }}
                                    {% else %}
                                        {{ cost.product.name }}
                                    {% endif %}
                                </span>
                            </td>
                            <td class="plot-grid-td plot-grid-td-center">
                                <span class="plot-grid-text">{{ cost.quantity|floatformat:2|safe }}</span>
                            </td>
                            <td class="plot-grid-td plot-grid-td-center">
                                {% if cost.application_cost %}
                                    <span class="plot-grid-text" style="color: var(--pg-active-text); font-weight: 500;">S/ {{ cost.application_cost|floatformat:2 }}</span>
                                {% elif cost.product.unit_price %}
                                    <span class="plot-grid-text" style="color: var(--pg-active-text); font-weight: 500;">S/ {{ cost.product.unit_price|floatformat:2 }}</span>
                                {% else %}
                                    <span class="plot-grid-muted">—</span>
                                {% endif %}
                            </td>
                            <td class="plot-grid-td plot-grid-td-center">
                                {% if cost.total_cost %}
                                    <span class="plot-grid-text-strong">S/ {{ cost.total_cost|floatformat:2 }}</span>
                                {% else %}
                                    <span class="plot-grid-muted">—</span>
                                {% endif %}
                            </td>
                            <td class="plot-grid-td plot-grid-td-actions">
                                <button type="button" class="plot-grid-btn-edit item-edit" pk="{{ cost.id }}" title="Editar Costo">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="plot-grid-footer-inline">
                    <tr>
                        <td colspan="6" class="plot-grid-td plot-grid-td-right plot-grid-text-strong">
                            <i class="fas fa-calculator"></i> TOTAL ACUMULADO:
                        </td>
                        <td class="plot-grid-td plot-grid-td-center">
                            <span class="plot-grid-badge-soft plot-grid-text-strong">S/ {% if total_accumulated %}{{ total_accumulated|floatformat:2 }}{% else %}0.00{% endif %}</span>
                        </td>
                        <td class="plot-grid-td"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <div class="plot-grid-footer">
            <span class="plot-grid-footer-item">
                <i class="fas fa-info-circle"></i>
                Total: <strong>{{ cost_set.count }}</strong> registro{{ cost_set.count|pluralize:"s" }}
            </span>
            <span class="plot-grid-footer-item">
                <i class="fas fa-clock"></i>
                Actualizado: <strong>{{ last_update|date:"d/m/Y H:i" }}</strong>
            </span>
        </div>
    </div>
{% else %}
    <div class="plot-grid-empty">
        <div class="plot-grid-empty-icon">
            {% if cost_type == 'agrochemicals' %}
                <i class="fas fa-flask"></i>
            {% elif cost_type == 'services' %}
                <i class="fas fa-cog"></i>
            {% else %}
                <i class="fas fa-dollar-sign"></i>
            {% endif %}
        </div>
        <h3 class="plot-grid-empty-title">
            {% if cost_type == 'agrochemicals' %}
                No hay agroquímicos registrados para este cultivo
            {% elif cost_type == 'services' %}
                No hay servicios registrados para este cultivo
            {% else %}
                No hay costos registrados para este cultivo
            {% endif %}
        </h3>
        <p class="plot-grid-empty-text">
            {% if cost_type == 'agrochemicals' %}
                Comienza registrando el primer agroquímico para este cultivo
            {% elif cost_type == 'services' %}
                Comienza registrando el primer servicio para este cultivo
            {% else %}
                Comienza registrando el primer costo para este cultivo
            {% endif %}
        </p>
        <button type="button" onclick="showModalCreate()" class="plot-grid-empty-btn">
            <i class="fas fa-plus"></i>
            {% if cost_type == 'agrochemicals' %}
                Registrar Primer Agroquímico
            {% elif cost_type == 'services' %}
                Registrar Primer Servicio
            {% else %}
                Registrar Primer Costo
            {% endif %}
        </button>
    </div>
{% endif %}

