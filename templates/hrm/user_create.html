{% load static %}
<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content roboto-condensed-regular hrm-modal hrm-modal-employee">
        <div id="modal-loader" class="hrm-modal-overlay" style="display: none">
            <div class="d-flex justify-content-center align-items-center h-100">
                <div class="spinner-border text-primary" role="status"><span class="sr-only">Cargando...</span></div>
            </div>
        </div>
        <div class="hrm-modal-header">
            <h5 class="hrm-modal-title">
                <i class="fas fa-user-plus"></i>
                Nuevo Colaborador
            </h5>
            <button type="button" class="hrm-modal-close" data-dismiss="modal" aria-label="Cerrar">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <form id="form-user" action="{% url 'apps.hrm:create_user' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="hrm-modal-body modal-body p-4">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="hrm-form-section">
                            <div class="hrm-form-section-header"><i class="fas fa-user"></i> Información Personal</div>
                            <div class="hrm-form-section-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Nombres *</label>
                                        <input type="text" class="form-control hrm-input" id="first_name" autocomplete="off"
                                               name="first_name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Apellidos *</label>
                                        <input type="text" class="form-control hrm-input" id="last_name" autocomplete="off"
                                               name="last_name" required>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Documento *</label>
                                        <input type="text" class="form-control hrm-input" id="document" autocomplete="off"
                                               name="document" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Fecha de Nacimiento</label>
                                        <input type="date" class="form-control hrm-input" name="birth-date" value="{{ date_now }}">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Género</label>
                                        <select class="form-control hrm-input" name="gender">
                                            {% for g in gender_set %}<option value="{{ g.0 }}">{{ g.1 }}</option>{% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Nacionalidad</label>
                                        <select class="form-control hrm-input" name="nationality">
                                            {% for n in nationality_set %}<option value="{{ n.0 }}">{{ n.1 }}</option>{% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Estado Civil</label>
                                        <select class="form-control hrm-input" name="marital-status">
                                            {% for m in marital_status_set %}<option value="{{ m.0 }}">{{ m.1 }}</option>{% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Educación</label>
                                        <select class="form-control hrm-input" name="education">
                                            {% for e in education_set %}<option value="{{ e.0 }}">{{ e.1 }}</option>{% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label font-weight-bold">Dirección</label>
                                    <input type="text" class="form-control hrm-input" autocomplete="off"
                                           name="address" placeholder="Ingrese dirección completa">
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Teléfono</label>
                                        <input type="text" class="form-control hrm-input" autocomplete="off"
                                               name="phone" placeholder="Número telefónico">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Celular</label>
                                        <input type="text" class="form-control hrm-input" autocomplete="off"
                                               name="cellphone" placeholder="Número celular">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hrm-form-section">
                            <div class="hrm-form-section-header"><i class="fas fa-envelope"></i> Información de Contacto</div>
                            <div class="hrm-form-section-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Correo Electrónico *</label>
                                        <input type="email" class="form-control hrm-input" autocomplete="off"
                                               name="email" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Usuario</label>
                                        <input type="text" class="form-control hrm-input" autocomplete="off"
                                               name="username" placeholder="Nombre de usuario">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Contraseña *</label>
                                        <input type="password" class="form-control hrm-input" name="password" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label font-weight-bold">Sucursal *</label>
                                        <select class="form-control hrm-input" name="subsidiary" required>
                                            <option value="">Seleccione una sucursal</option>
                                            {% for s in subsidiary_set %}<option value="{{ s.id }}">{{ s.name }}</option>{% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="hrm-form-section">
                            <div class="hrm-form-section-header"><i class="fas fa-camera"></i> Foto del Colaborador</div>
                            <div class="hrm-form-section-body text-center">
                                <div class="mb-3">
                                    <img id="blah" class="img-fluid rounded-circle border" width="150" height="150"
                                         src="{% static 'img/employee/employee.jpg' %}" style="object-fit: cover;">
                                </div>
                                <input type="file" class="form-control-file" id="exampleInputFile" name="exampleInputFile"
                                       onchange="readURL(this);" accept="image/*">
                                <small class="text-muted d-block mt-2">Formatos: JPG, PNG, GIF. Máximo 2MB</small>
                            </div>
                        </div>
                        <div class="hrm-form-section">
                            <div class="hrm-form-section-header"><i class="fas fa-shield-alt"></i> Permisos del Sistema</div>
                            <div class="hrm-form-section-body">
                                <div class="custom-control custom-switch mb-3">
                                    <input type="checkbox" class="custom-control-input" id="customCheckActive" name="customCheckActive" checked>
                                    <label class="custom-control-label" for="customCheckActive">Usuario Activo</label>
                                </div>
                                <div class="custom-control custom-switch mb-3">
                                    <input type="checkbox" class="custom-control-input" id="customCheckboxAccess" name="customCheckboxAccess" checked>
                                    <label class="custom-control-label" for="customCheckboxAccess">Acceso al Sistema</label>
                                </div>
                                <div class="custom-control custom-switch mb-3">
                                    <input type="checkbox" class="custom-control-input" id="customCheckboxHrm" name="customCheckboxHrm">
                                    <label class="custom-control-label" for="customCheckboxHrm">Acceso a RRHH</label>
                                </div>
                                <div class="custom-control custom-switch mb-3">
                                    <input type="checkbox" class="custom-control-input" id="customCheckboxReport" name="customCheckboxReport">
                                    <label class="custom-control-label" for="customCheckboxReport">Acceso a Reportes</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="hrm-modal-footer">
                <button type="button" class="hrm-btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-1"></i>Cancelar
                </button>
                <button type="submit" class="hrm-btn-primary">
                    <i class="fas fa-save mr-1"></i>Registrar Colaborador
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    .hrm-modal.hrm-modal-employee { border-radius: 16px; border: 2px solid #2e7d32; overflow: hidden; }
    .hrm-modal .hrm-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        padding: 1rem 1.25rem;
        background: #e8f5e9;
        border-bottom: 2px solid #2e7d32;
        border-radius: 14px 14px 0 0;
    }
    .hrm-modal-title { margin: 0; font-size: 1.1rem; font-weight: 600; color: #334155; }
    .hrm-modal-title i { margin-right: 0.5rem; color: #2e7d32; }
    .hrm-modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        line-height: 1;
        color: #334155;
        opacity: 0.8;
        cursor: pointer;
        padding: 0.25rem;
        margin-left: auto;
    }
    .hrm-modal-close:hover { opacity: 1; }
    .hrm-modal-body { background: #f1f5f9; padding: 1rem 1.25rem !important; }
    .hrm-form-section { border-radius: 14px; border: 2px solid #e8ecf0; margin-bottom: 0.6rem; overflow: hidden; background: #fff; }
    .hrm-form-section-header { padding: 0.6rem 1rem; background: #f8faf9; font-weight: 600; font-size: 0.9rem; color: #334155; border-bottom: 2px solid #e8ecf0; }
    .hrm-form-section-header i { margin-right: 0.5rem; color: #2e7d32; }
    .hrm-form-section-body { padding: 0.9rem 1rem; }
    .hrm-input { border-radius: 10px; border: 2px solid #e2e8f0; }
    .hrm-input:focus { border-color: #2e7d32; box-shadow: 0 0 0 2px rgba(46,125,50,0.15); }
    .hrm-modal-footer { display: flex; justify-content: flex-end; gap: 0.5rem; padding: 1rem 1.25rem; background: #f8faf9; border-top: 2px solid #e8ecf0; border-radius: 0 0 14px 14px; }
    .hrm-btn-primary { display: inline-flex; align-items: center; padding: 0.5rem 1.25rem; font-size: 0.875rem; font-weight: 500; color: #fff; background: #5d4037; border: 1.5px solid #5d4037; border-radius: 9999px; cursor: pointer; }
    .hrm-btn-primary:hover { background: #4e342e; border-color: #4e342e; color: #fff; }
    .hrm-btn-secondary { display: inline-flex; align-items: center; padding: 0.5rem 1.25rem; font-size: 0.875rem; font-weight: 500; color: #5d4037; background: transparent; border: 1.5px solid #5d4037; border-radius: 9999px; cursor: pointer; }
    .hrm-btn-secondary:hover { background: #5d4037; color: #fff; }
    .hrm-modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 1000; border-radius: 14px; }
    .custom-control-input:checked ~ .custom-control-label::before { background-color: #2e7d32; border-color: #2e7d32; }
</style>

<script type="text/javascript">
function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) { $('#blah').attr('src', e.target.result); };
        reader.readAsDataURL(input.files[0]);
    }
}
$('#form-user').submit(function(event) {
    event.preventDefault();
    $('#modal-loader').show();
    var formData = new FormData(this);
    $.ajax({
        url: $(this).attr('action'),
        type: 'POST',
        data: formData,
        cache: false,
        processData: false,
        contentType: false,
        headers: {"X-CSRFToken": '{{ csrf_token }}'},
        success: function(response) {
            $('#modal-loader').hide();
            if (response.success) {
                toastr.success(response.message, '¡Éxito!');
                setTimeout(function() { location.reload(); }, 1500);
            } else {
                toastr.error(response.message, 'Error');
            }
        },
        error: function() {
            $('#modal-loader').hide();
            toastr.error('Ocurrió un problema al registrar el colaborador', 'Error');
        }
    });
});
</script>
