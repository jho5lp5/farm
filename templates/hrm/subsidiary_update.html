<div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content roboto-condensed-regular hrm-modal hrm-modal-subsidiary">
        <div class="modal-header" style="background-color: #97bf99;">
            <h5 class="modal-title text-white">
                Actualizar Sucursal
            </h5>
            <button type="button" class="hrm-modal-close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>

        <form id="form-subsidiary-update" action="{% url 'apps.hrm:update_subsidiary' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" value="{{ subsidiary_obj.id }}" id="id-pk" name="pk">

            <div class="hrm-modal-body modal-body p-4">
                <!-- Información Básica -->
                <div class="hrm-form-section">
                    <div class="hrm-form-section-header">
                        <i class="fas fa-info-circle"></i>
                        Información Básica
                    </div>
                    <div class="hrm-form-section-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-hashtag mr-1"></i>
                                        Serie Sucursal
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-serial"
                                           maxlength="4"
                                           name="serial"
                                           value="{{ subsidiary_obj.serial|default:'' }}"
                                           placeholder="Ej: 001">
                                    <small class="form-text text-muted">Máximo 4 caracteres</small>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-building mr-1"></i>
                                        Nombre de la Sucursal
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-name"
                                           maxlength="100"
                                           name="name"
                                           value="{{ subsidiary_obj.name }}"
                                           placeholder="Ingrese el nombre de la sucursal"
                                           required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información de Contacto -->
                <div class="hrm-form-section">
                    <div class="hrm-form-section-header">
                        <i class="fas fa-address-book"></i>
                        Información de Contacto
                    </div>
                    <div class="hrm-form-section-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-phone mr-1"></i>
                                        Teléfono
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           data-inputmask="'mask': ['999-999-999 [x99999]', '+099 99 99 9999[9]-9999']"
                                           data-mask
                                           id="id-phone"
                                           name="phone"
                                           value="{{ subsidiary_obj.phone|default:'' }}"
                                           placeholder="Ej: 01-123-4567">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-envelope mr-1"></i>
                                        Correo Electrónico
                                    </label>
                                    <input type="email"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-email"
                                           maxlength="45"
                                           name="email"
                                           value="{{ subsidiary_obj.email|default:'' }}"
                                           placeholder="sucursal@empresa.com">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-map-marker-alt mr-1"></i>
                                        Dirección
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-address"
                                           maxlength="200"
                                           name="address"
                                           value="{{ subsidiary_obj.address|default:'' }}"
                                           placeholder="Ingrese la dirección completa">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información Empresarial -->
                <div class="hrm-form-section">
                    <div class="hrm-form-section-header">
                        <i class="fas fa-briefcase"></i>
                        Información Empresarial
                    </div>
                    <div class="hrm-form-section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-id-card mr-1"></i>
                                        RUC
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-ruc"
                                           maxlength="11"
                                           name="ruc"
                                           value="{{ subsidiary_obj.ruc|default:'' }}"
                                           placeholder="11 dígitos"
                                           required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-building mr-1"></i>
                                        Razón Social
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-business-name"
                                           maxlength="100"
                                           name="business-name"
                                           value="{{ subsidiary_obj.business_name|default:'' }}"
                                           placeholder="Razón social de la empresa"
                                           required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Información del Representante -->
                <div class="hrm-form-section">
                    <div class="hrm-form-section-header">
                        <i class="fas fa-user-tie"></i>
                        Información del Representante
                    </div>
                    <div class="hrm-form-section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-id-badge mr-1"></i>
                                        DNI del Representante
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-representative-dni"
                                           maxlength="45"
                                           name="representative-dni"
                                           value="{{ subsidiary_obj.representative_dni|default:'' }}"
                                           placeholder="Número de documento">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label font-weight-bold">
                                        <i class="fas fa-user mr-1"></i>
                                        Nombre del Representante
                                    </label>
                                    <input type="text"
                                           class="form-control form-control-sm hrm-input"
                                           id="id-representative-name"
                                           maxlength="100"
                                           name="representative-name"
                                           value="{{ subsidiary_obj.representative_name|default:'' }}"
                                           placeholder="Nombre completo del representante">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Observaciones -->
                <div class="hrm-form-section">
                    <div class="hrm-form-section-header">
                        <i class="fas fa-sticky-note"></i>
                        Observaciones
                    </div>
                    <div class="hrm-form-section-body">
                        <div class="form-group mb-0">
                            <label class="form-label font-weight-bold">
                                <i class="fas fa-comment mr-1"></i>
                                Observaciones
                            </label>
                            <textarea class="form-control form-control-sm hrm-input"
                                      id="id-observation-input"
                                      maxlength="500"
                                      name="observation-input"
                                      rows="3"
                                      placeholder="Ingrese observaciones si es necesario">{{ subsidiary_obj.observation|default:'' }}</textarea>
                            <small class="form-text text-muted">Máximo 500 caracteres</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hrm-modal-footer">
                <button type="button" class="hrm-btn-secondary" data-dismiss="modal">
                    <i class="fas fa-times mr-1"></i>
                    Cancelar
                </button>
                <button id="update-subsidiary" type="submit" class="hrm-btn-primary">
                    <i class="fas fa-save mr-1"></i>
                    Actualizar Sucursal
                </button>
            </div>
        </form>
    </div>
</div>

<style>
    .hrm-modal.hrm-modal-subsidiary {
        border-radius: 16px;
        border: 2px solid #2e7d32;
        overflow: hidden;
    }
    .hrm-modal .hrm-modal-header {
        padding: 1rem 1.25rem;
        background: #e8f5e9;
        border-bottom: 2px solid #2e7d32;
        border-radius: 14px 14px 0 0;
    }
    .hrm-modal-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        color: #334155;
    }
    .hrm-modal-title i {
        margin-right: 0.5rem;
        color: #2e7d32;
    }
    .hrm-modal-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        color: #334155;
        opacity: 0.8;
        cursor: pointer;
    }
    .hrm-modal-close:hover {
        opacity: 1;
    }
    .hrm-modal-body {
        background: #f1f5f9;
        padding: 1rem 1.25rem !important;
    }
    .hrm-form-section {
        border-radius: 14px;
        border: 2px solid #e8ecf0;
        margin-bottom: 0.6rem;
        overflow: hidden;
        background: #ffffff;
        box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    }
    .hrm-form-section-header {
        padding: 0.6rem 1rem;
        background: #f8faf9;
        font-weight: 600;
        font-size: 0.9rem;
        color: #334155;
        border-bottom: 2px solid #e8ecf0;
    }
    .hrm-form-section-header i {
        margin-right: 0.5rem;
        color: #2e7d32;
    }
    .hrm-form-section-body {
        padding: 0.9rem 1rem;
    }
    .hrm-input {
        border-radius: 10px;
        border: 2px solid #e2e8f0;
    }
    .hrm-input:focus {
        border-color: #2e7d32;
        box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.15);
    }
    .hrm-modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 0.5rem;
        padding: 1rem 1.25rem;
        background: #f8faf9;
        border-top: 2px solid #e8ecf0;
        border-radius: 0 0 14px 14px;
    }
    .hrm-btn-primary {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #fff;
        background: #5d4037;
        border: 1.5px solid #5d4037;
        border-radius: 9999px;
        cursor: pointer;
        transition: background 0.2s ease, border-color 0.2s ease;
    }
    .hrm-btn-primary:hover {
        background: #4e342e;
        border-color: #4e342e;
        color: #fff;
    }
    .hrm-btn-secondary {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #5d4037;
        background: transparent;
        border: 1.5px solid #5d4037;
        border-radius: 9999px;
        cursor: pointer;
        transition: background 0.2s ease, color 0.2s ease;
    }
    .hrm-btn-secondary:hover {
        background: #5d4037;
        color: #fff;
    }
</style>

<script type="text/javascript">
$(document).ready(function() {
    if ($.fn.inputmask) {
        $('[data-mask]').inputmask();
    }

    $('#form-subsidiary-update').submit(function (event) {
        event.preventDefault();

        let isValid = true;
        $(this).find('[required]').each(function() {
            if (!$(this).val().trim()) {
                $(this).addClass('is-invalid');
                isValid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        if (!isValid) {
            toastr.error('Por favor complete todos los campos requeridos');
            return;
        }

        $('#update-subsidiary').prop('disabled', true).html('<i class="fas fa-spinner fa-spin mr-1"></i>Actualizando...');

        let data = new FormData($('#form-subsidiary-update').get(0));

        $.ajax({
            url: $(this).attr('action'),
            type: $(this).attr('method'),
            data: data,
            cache: false,
            processData: false,
            contentType: false,
            headers: {"X-CSRFToken": '{{ csrf_token }}'},
            success: function (response) {
                if (response.success) {
                    toastr.success(response.message);
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                } else {
                    toastr.error(response.message);
                }
            },
            error: function (xhr, status, error) {
                toastr.error('Ocurrió un problema al actualizar la sucursal');
                console.error('Error:', error);
            },
            complete: function() {
                $('#update-subsidiary').prop('disabled', false).html('<i class="fas fa-save mr-1"></i>Actualizar Sucursal');
            }
        });
    });

    $('input, textarea').on('input', function() {
        $(this).removeClass('is-invalid');
    });
});
</script>
